<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Customer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #F3E5F5);
    }

    .main-container {
      display: flex;
      position: relative; /* Needed for absolute positioning of the button */
      max-width: 1200px;
      margin: 40px auto;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .left-panel, .right-panel {
      padding: 100px 70px 70px 70px;
      flex: 1;
    }

    .left-panel {
      border-right: 1px solid #ddd;
    }

    h2 {
      text-align: center;
      color: #004aad;
      margin-bottom: 20px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      background-color: #f9f9f9;
      font-size: 14px;
    }

    textarea {
      grid-column: 1 / -1;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #004aad;
      outline: none;
    }

    .top-button {
      position: absolute;
      top: 20px;
      right: 30px;
      padding: 12px 20px;
      background: linear-gradient(to right, #004aad, #007bff);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      z-index: 10;
    }

    .upload-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 52px;
    }

    .upload-box {
      border: 2px dashed #004aad;
      padding: 15px;
      text-align: center;
      border-radius: 10px;
      background-color: #f0f8ff;
    }

    .upload-box input {
      display: none;
    }

    .upload-box label {
      cursor: pointer;
      color: #004aad;
      font-weight: bold;
    }

    .preview-img, .preview-doc {
      margin-top: 10px;
      max-width: 100%;
      border-radius: 10px;
    }

    .preview-doc {
      font-size: 14px;
      color: #333;
    }

    @media (max-width: 900px) {
      .main-container {
        flex-direction: column;
      }

      .left-panel, .right-panel {
        border-right: none;
        border-bottom: 1px solid #ddd;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .top-button {
        position: static;
        width: 100%;
        margin: 0 auto 20px;
        display: block;
      }

      .upload-section {
        margin-top: 30px;
      }
    }
  </style>
</head>
<body>

<div class="main-container">
  <h2 style="position: absolute; top: 20px; left: 30px;">Create New Customer</h2>
  <button type="submit" form="customerForm" class="top-button">Save</button>

  <div class="left-panel">
    <form action="/customers/create" method="POST" id="customerForm" enctype="multipart/form-data">
      <div class="form-grid">
        <input type="text" name="customer_code" placeholder="Customer Code" required />
        <input type="text" name="name" placeholder="Customer Name" required />
        <input type="text" name="contact_no" placeholder="Contact Number" required />
        <input type="text" name="alt_contact_no" placeholder="Alternate Contact Number" />
        <input type="date" name="start_date" id="start_date" required />
        <input type="date" name="end_date" id="end_date" readonly required />
        <input type="number" name="loan_duration" placeholder="Loan Duration (months)" required />
        <input type="number" name="loan_amount" id="loan_amount" placeholder="Loan Amount" required />
        <input type="number" name="file_charge" id="file_charge" placeholder="File Charge" />
        <input type="number" name="agent_fee" id="agent_fee" placeholder="Agent Fee" />
        <input type="number" name="emi" id="emi" placeholder="EMI" />
        <input type="number" name="advance_days" id="advance_days" placeholder="Advance Days" />
        <input type="number" name="amount_after_deduction" id="amount_after_deduction" placeholder="Amount After EMI Deduction" readonly />
        <input type="number" name="agent_commission" placeholder="Agent Commission in EMI" />
        <select name="status" required>
          <option value="">Select Status</option>
          <option value="active">Active</option>
          <option value="closed">Closed</option>
        </select>
        <textarea name="remark" placeholder="Remark (optional)" rows="4"></textarea>
      </div>
    </form>
  </div>

  <div class="right-panel">
    <div class="upload-section">
      <div class="upload-box">
        <label for="photoUpload">ðŸ“· Upload Photo</label>
        <input type="file" id="photoUpload" name="customerphoto" accept="image/*" />
        <img id="photoPreview" class="preview-img" style="display: none;" />
      </div>

      <div class="upload-box">
        <label for="docUpload">ðŸ“„ Upload Document</label>
        <input type="file" id="docUpload" name="customerdocument" />
        <div id="docPreview" class="preview-doc"></div>
      </div>
    </div>
  </div>
</div>

<script>
  // Auto End Date
  const startDate = document.getElementById('start_date');
  const endDate = document.getElementById('end_date');
  startDate.addEventListener('change', () => {
    const start = new Date(startDate.value);
    if (!isNaN(start.getTime())) {
      const end = new Date(start);
      end.setDate(start.getDate() + 100);
      endDate.value = end.toISOString().split('T')[0];
    }
  });

  // EMI Deduction Calculation
  function calculateDeduction() {
    const loanAmount = parseFloat(document.getElementById('loan_amount').value) || 0;
    const fileCharge = parseFloat(document.getElementById('file_charge').value) || 0;
    const agentFee = parseFloat(document.getElementById('agent_fee').value) || 0;
    const emi = parseFloat(document.getElementById('emi').value) || 0;
    const advanceDays = parseFloat(document.getElementById('advance_days').value) || 0;

    const deduction = loanAmount - fileCharge - agentFee - (emi * advanceDays);
    document.getElementById('amount_after_deduction').value = deduction > 0 ? deduction.toFixed(2) : 0;
  }

  ['loan_amount', 'file_charge', 'agent_fee', 'emi', 'advance_days'].forEach(id => {
    document.getElementById(id).addEventListener('input', calculateDeduction);
  });

  // Photo Preview
  const photoInput = document.getElementById('photoUpload');
  const photoPreview = document.getElementById('photoPreview');
  photoInput.addEventListener('change', () => {
    const file = photoInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        photoPreview.src = e.target.result;
        photoPreview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
  });

  // Document Preview
  const docInput = document.getElementById('docUpload');
  const docPreview = document.getElementById('docPreview');
  docInput.addEventListener('change', () => {
    const file = docInput.files[0];
    if (file) {
      docPreview.innerText = `Selected: ${file.name}`;
    }
  });
</script>

</body>
</html>